{% extends '::base.html.twig' %}

{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/dataTables.bootstrap.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/dataTables.colVis.css') }}">
{% endblock %}
{% block content %}
<!-- START DATATABLE 1 -->
<div class="container-fluid ">
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default panel-warning">
                <div class="panel-body">
                    <div class="form-group">
                        <div class="col-lg-12 col-sm-12" id="userSearch">
                            <input type="text" id="user" name="user" class="typeahead input-lg form-control" placeholder="Vartotojų paieška" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default panel-warning">
                <div class="panel-heading panel-warning">Komandos</div>
                <div class="panel-body">
                    <div class="col-lg-12">
                        <div class="table-responsive">
                            <table id="datatable1" class="table table-striped table-hover datatable">
                                <thead>
                                <tr>
                                    <th>Pavadinimas</th>
                                    <th>Tipas</th>
                                    <th>Žaidėjų skaičius</th>
                                    <th>Teisės</th>
                                    <th>Sukurta</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for team in teams %}
                                <tr>
                                    <td>
                                        <a href="{{ path('basket_planner_team_show', {'id': team[0].id}) }}">
                                            {{ team[0].name }}
                                        </a>
                                    </td>
                                    <td>{{ team[0].type.name }}</td>
                                    <td>{{ teamService.getTeamPlayersCount(team[0].id) }}{# {{ team.playersCount }}#}/{{ team[0].type.players }}</td>
                                    {% if team.role == "Owner" %}
                                        <td>Sąvininkas</td>
                                    {% else %}
                                        <td>Žaidėjas</td>
                                    {% endif %}
                                    <td>{{ team[0].created.format('M d Y H:i') }}</td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
    <script type="text/javascript" charset="utf8" src="{{ asset('assets/js/jquery.dataTables.min.js') }}"></script>
    <script type="text/javascript" charset="utf8" src="{{ asset('assets/js/dataTables.bootstrap.js') }}"></script>
    <script type="text/javascript" charset="utf8"
            src="{{ asset('assets/js/dataTables.bootstrapPagination.js') }}"></script>
    <script type="text/javascript">
        $(function () {
            $('#datetimepicker1').datetimepicker({
                format: 'L',
                pickTime: false
            });
            $('#datetimepicker2').datetimepicker({
                format: 'HH:mm',
                pickDate: false,
                pickSeconds: false,
                pick12HourFormat: false
            });
        });
        $(document).ready(function () {
            $('#datatable1').DataTable({
                'paging': true,  // Table pagination
                'ordering': true,  // Column ordering
                'info': false,  // Bottom left status text
                'autoWidth': true,
                oLanguage: {
                    empty: 'Susijusių įrašų nerasta',
                    sSearch: 'Paieška:',
                    sLengthMenu: '_MENU_ įrašų puslapyje',
                    info: 'Rodomas _PAGE_ puslapis iš _PAGES_',
                    zeroRecords: 'Matchų nerasta.',
                    infoEmpty: 'Nėra įrašų',
                    infoFiltered: '(surasta iš _MAX_ visų įrašų)',
                    sEmptyTable: 'Nėra įrašų',
                    "oPaginate": {
                        "sFirst": "Pirmas",
                        "sNext": "Paskutinis",
                        "sLast": "Kitas",
                        "sPrevious": "Ankstesnis"
                    }
                }
            });

            var engine = new Bloodhound({
                datumTokenizer: function (datum) {
                    return Bloodhound.tokenizers.whitespace(datum.firstName);
                },
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                prefetch: {
                    url: '{{ url('basket_planner_team.search')}}',
                    filter: function (data) {
                        console.log("data", data)
                        return $.map(data, function (user) {
                            return {
                                id: user.id,
                                firstName: user.firstName,
                                lastName: user.lastName,
                                email: user.email,
                                profilePicture: user.profilePicture
                            };
                        });
                    }
                }
            });

            engine.initialize();

            $('#userSearch .typeahead').typeahead(
            {
                hint: true,
                highlight: true,
                minLength: 2,
                limit:10,
                classNames: {
                    open: 'is-open',
                    empty: 'is-empty',
                    cursor: 'is-active',
                    suggestion: 'Typeahead-suggestion',
                    selectable: 'Typeahead-selectable'
                }
            },
            {
                name: 'engine',
                displayKey: 'firstName',
                source: engine.ttAdapter(),
                templates: {
                    empty: [
                        '<div class="empty-message hint-large">',
                        'Pagal šią užklausą vartotojų rasti nepavyko.',
                        '</div>'
                    ].join('\n'),
                    {% verbatim %}
                    suggestion: Handlebars.compile('<div class="hint-large">' +
                     '<a class="pull-left" href="#">' +
                        '<img role="button" alt="Image" class="media-object img-rounded author-img thumb16" src= "{{profilePicture}}">' +
                     '</a><div class="media-body tt-hint-body">{{firstName}} {{lastName}} <small> {{email}} </small> </div>' +
                     '</div>')
                    {% endverbatim %}
                }
            });
            $('.typeahead.input-sm').siblings('input.tt-hint').addClass('hint-small');
            $('.typeahead.input-lg').siblings('input.tt-hint').addClass('hint-large');
        });
    </script>
{% endblock %}
